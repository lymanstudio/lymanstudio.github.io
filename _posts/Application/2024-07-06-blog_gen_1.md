---
layout: single
title:  "LLMì„ ì´ìš©í•œ ë¸”ë¡œê·¸ ë³€í™˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì œì‘ [ìƒ] ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ê¸€ ì €ì¥ ë° ìë™ ìº¡ì²˜í•˜ê¸°"
classes: wide
categories: Application
tags: [LangChain, Appllcation, Blog Post Gen]

---

ì´ë²ˆ í”„ë¡œì íŠ¸ì˜ ëª©í‘œëŠ” ë„¤ì´ë²„ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ í‹°ìŠ¤í† ë¦¬ë¡œ ì˜®ê¸°ëŠ” ê²ƒì´ë‹¤. í”„ë¡œì íŠ¸ì˜ ëª©í‘œëŠ” ì´ë ‡ê²Œ í•œ ë¬¸ì¥ìœ¼ë¡œ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆì„ ë§ˆí¼ ê°„ë‹¨í•˜ë‚˜ ë„¤ì´ë²„, í‹°ìŠ¤í† ë¦¬ë¼ëŠ” ë‘ ì„œë¹„ìŠ¤ ì œê³µìì˜ ì—¬ëŸ¬ ì œì•½ ì‚¬í•­ìœ¼ë¡œ ìë™í™”ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì„ íŒŒì•…í–ˆë‹¤. ì´ì— ì™„ì „ ìë™í™”ëŠ” ëª»í•˜ì˜€ê³ ... ë°˜ìë™í™” ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì œì‘í–ˆë‹¤.

# ê°œìš”/í•„ìš” ê¸°ëŠ¥ ì •ë¦¬

í”„ë¡œì íŠ¸ê°€ ìˆ˜í–‰í•˜ëŠ” ê¸°ëŠ¥ì„ ë‹¨ê³„ë³„ë¡œ ë‚˜ëˆ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

1. ê¸° ì‘ì„±ëœ ë„¤ì´ë²„ ë¸”ë¡œê·¸ ê¸€ì„ ê°€ì ¸ì™€ ë¶„ì„í•œë‹¤.
   - ì´ ë•Œ ê¸€ë¿ ì•„ë‹ˆë¼ ì´ë¯¸ì§€ë„ ê°€ì ¸ì™€ì•¼ í•œë‹¤.
2. ì‘ì„±ëœ ë„¤ì´ë²„ ê¸€ì„ ì°¸ì¡°í•˜ì—¬ ê°€ì ¸ì˜¨ ê¸€, ê·¸ë¦¼ì„ ì´ìš©í•´ í¬ë§·íŒ… ëœ ìƒíƒœë¡œ ì¬êµ¬ì„±í•œë‹¤(HTML, markdown ë“±).
3. ìƒˆë¡œìš´ ê¸€ì— ëŒ€í•´ ìë™ìœ¼ë¡œ í¬ìŠ¤íŠ¸ ê¸€ë¡œ ë°”ë€Œë„ë¡ ëª¨ë¸ì„ êµ¬ì„±í•œë‹¤.  

4. í¬ë§·íŒ…ëœ ê¸€ì„ ê·¸ëŒ€ë¡œ í‹°ìŠ¤í† ë¦¬ì— ì—…ë¡œë“œ í•œë‹¤.



ì´ë¥¼ ìœ„í•´ ìš°ë¦¬ê°€ í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- ë„¤ì´ë²„ ë¸”ë¡œê·¸ ê¸€ ê°€ì ¸ì˜¤ê¸°
  - ê¸€, ê·¸ë¦¼ ë°±ì—… í›„ í¬ìŠ¤íŠ¸ë³„ë¡œ ì •ë¦¬
  - ìë™ ë„¤ì´ë²„ í¬ìŠ¤íŠ¸ ìº¡ì²˜ ê¸°ëŠ¥

- ê°€ì ¸ì˜¨ ê¸€, ê·¸ë¦¼ì„ ì°¸ì¡°í•´ ê¸€ì„ í¬ë§·íŒ… ëœ ìƒíƒœë¡œ êµ¬ì„±
  - ìº¡ì²˜ëœ í¬ìŠ¤íŠ¸ì™€ ê¸€ì„ ì°¸ì¡°í•´ plain textë¥¼ í¬ë©§íŒ…ëœ í˜•íƒœë¡œ ë°”ê¿”ì£¼ëŠ” ìƒì„± ëª¨ë¸ => ëª¨ë¸ A

- ìƒˆë¡œìš´ ê¸€ì— ëŒ€í•´ ìë™ìœ¼ë¡œ í¬ìŠ¤íŠ¸ ê¸€ì„ ë³€í™˜
  - ì´ì „ í¬ìŠ¤íŠ¸ ì½”ë“œë¥¼ ì°¸ì¡°í•´ ìƒˆë¡œìš´ ê¸€ì— ëŒ€í•´ ê°™ì€ í˜•íƒœë¡œ ë°”ê¿”ì£¼ëŠ” ìƒì„± ëª¨ë¸ => ëª¨ë¸ B




ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„  ì²«ë²ˆì§¸ë¡œ ë„¤ì´ë²„ í¬ìŠ¤íŠ¸ ê¸€/ê·¸ë¦¼ ë°±ì—… ë° ì •ë¦¬, ê·¸ë¦¬ê³  í¬ìŠ¤íŠ¸ ì´ë¯¸ì§€ ìë™ ìº¡ì²˜ ê¸°ëŠ¥ì— ëŒ€í•´ ì†Œê°œí•œë‹¤.

---



# Step1.  ë„¤ì´ë²„ ë¸”ë¡œê·¸ export & ë°ì´í„° ì •ë¦¬

ìš°ì„  ì²«ë²ˆì§¸ë¡œ ë„¤ì´ë²„ ë¸”ë¡œê·¸ì˜ ê¸€ì„ ë¹¼ë‚´ì™€ì•¼ í•œë‹¤.  ì›ë˜ëŠ” ìº¡ì²˜ëœ í¬ìŠ¤íŠ¸ì—ì„œ OCRì„ í†µí•´ ê¸€ì„ ê°€ì ¸ì˜¤ê³ ì í–ˆìœ¼ë‹ˆ í•œê¸€ì— ëŒ€í•œ OCR ê¸°ëŠ¥ì´ ë–¨ì–´ì§€ëŠ” ê±´ì§€... í€„ë¦¬í‹°ê°€ ë§¤ìš° ì¢‹ì§€ ì•Šì•„ í¬ê¸°í–ˆë‹¤.

í•˜ì§€ë§Œ ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìì²´ì ìœ¼ë¡œ í¬ìŠ¤íŠ¸ë¥¼ exportí•˜ëŠ” ê¸°ëŠ¥ì´ ìˆì–´ ì´ë¥¼ ì´ìš©í•´ í•œë²ˆì— ë‹¤ëŸ‰ì˜ í¬ìŠ¤íŠ¸ë¥¼ PDFë¡œ ë°›ì€ ë’¤ PDFíŒŒì¼ì„ crop, parseí•´ í¬ìŠ¤íŠ¸ ë‹¨ìœ„ë¡œ ê¸€ì„ ì €ì¥í•˜ëŠ” ë°©ë²•ì„ íƒí–ˆë‹¤. ê·¸ë¦¬ê³  ì´ ê³¼ì •ì—ì„œ ê·¸ë¦¼ë„ ê°™ì´ export ê°€ëŠ¥í–ˆë‹¤.

## ë„¤ì´ë²„ í¬ìŠ¤íŠ¸ export í•˜ê¸°

ë„¤ì´ë²„ ë¸”ë¡œê·¸ì—ì„  ê´€ë¦¬ì ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ë¡œ ê¸€ ì €ì¥ ê¸°ëŠ¥ì´ ìˆë‹¤.

- ìš°ì„  ë¸”ë¡œê·¸ì—ì„œ ê´€ë¦¬ ë²„íŠ¼ì„ í´ë¦­, ê´€ë¦¬ í˜ì´ì§€ë¡œ ê°„ ë’¤
  <img src="./../../images/2024-07-06-blog_gen_1/image-20240706104337519.png" alt="image-20240706104337519" style="zoom: 80%;" />

- **ê´€ë¦¬ í˜ì´ì§€** => ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°”ì—ì„œ **ì „ì²´ë³´ê¸°** => **ê¸€ ì €ì¥**ìœ¼ë¡œ ì´ë™í•œë‹¤.
  **<img src="./../../images/2024-07-06-blog_gen_1/image-20240706104556390.png" alt="image-20240706104556390" style="zoom: 60%;" />**

- ê¸€ ì €ì¥ í˜ì´ì§€ì—ì„œ PDF ë§Œë“¤ê¸° í›„ íŒŒì¼ ì œëª© ì…ë ¥, í¬ìŠ¤íŠ¸ë¥¼ ì—¬ëŸ¬ ê°œ ì„ íƒí•˜ì—¬ ì¶”ê°€ë¥¼ í•´ì¤€ë‹¤.
  <img src="./../../images/2024-07-06-blog_gen_1/image-20240706105217132.png" alt="image-20240706105217132" style="zoom:80%;" />

- ì—¬ëŸ¬ ê°œì˜ ê¸€ì„ í•œë²ˆì— ì €ì¥ ê°€ëŠ¥í•˜ë©° ê° í¬ìŠ¤íŠ¸ ë§ˆë‹¤ ì €ì¥ ìš©ëŸ‰ì´ ë‚˜ì˜¨ë‹¤. í•œë²ˆì— 500MBê¹Œì§€ ê°€ëŠ¥í•˜ë‹¤.
  <img src="./../../images/2024-07-06-blog_gen_1/image-20240706105358155.png" alt="image-20240706105358155" style="zoom:80%;" />
- ì´í›„ ì €ì¥ ëª©ë¡ íƒ­ìœ¼ë¡œ ì´ë™, ìƒì„±ì¤‘ì´ë¼ê³  í•˜ë©° íŒŒì¼ì´ ìƒì„±ë˜ê³  ë§ˆì¹œ ë’¤ ë‹¤ìš´ë¡œë“œë¥¼ ëˆŒëŸ¬ ë°›ì•„ì£¼ë©´ ëœë‹¤.
  ![image-20240706105642791](./../../images/2024-07-06-blog_gen_1/image-20240706105642791.png)



## PDF ë¬¸ì„œ ë°ì´í„° ì •ë¦¬

ì•ì„  ê³¼ì •ì„ í†µí•´ ë°›ì€ PDF íŒŒì¼ì— ì—¬ëŸ¬ í¬ìŠ¤íŠ¸ê°€ ë¶™ì—¬ì ¸ ìˆë‹¤.

ì´ PDF íŒŒì¼ì„ í¸ì§‘í•˜ì—¬ ë°ì´í„°ë¥¼ ë½‘ì•„ë‚´ê³  í¬ìŠ¤íŠ¸ë³„ë¡œ ì •ë¦¬í•´ì•¼í•˜ëŠ”ë° ì´ ê³¼ì •ì„ ì—¬ê¸°ì„œ pymupdf íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§„í–‰í–ˆë‹¤.

#### 1. íŒŒì¼ ì—´ê¸°

```python
base_dir = os.getcwd()
data_dir = os.path.join(base_dir, 'data')
pdf_dir = os.path.join(data_dir, 'pdf')

# ì»¤ë§¨ë“œ ë¼ì¸ìœ¼ë¡œ í¬ìŠ¤íŠ¸ íŒŒì¼ëª… ì…ë ¥
parser = argparse.ArgumentParser()
parser.add_argument('--file_name', required=True, help='ì‹¤í–‰í•  PDF íŒŒì¼ ì´ë¦„, í™•ì¥ì ì œì™¸')
args = parser.parse_args()
docs = pymupdf.open(os.path.join(pdf_dir, f'{args.file_name}.pdf'))
```

ìš°ì„  osë¡œ pdf_dirë¥¼ ì„¤ì •í•œ ë’¤ ì»¤ë§¨ë“œë¼ì¸ì—ì„œ íŒŒì¼ëª…ì„ ë°›ì•„ PDF íŒŒì¼ì„ ì—´ì–´ì¤€ë‹¤. ë‹¤ìŒìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì´ ê°„ë‹¨íˆ for ë¬¸ì„ ëŒë¦¬ë©´ PDF í˜ì´ì§€ ë‹¨ìœ„ë¡œ ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤.

```python
base_url = "http://blog.naver.com/{ë¸”ë¡œê·¸ ê¸°ë³¸ ì£¼ì†Œ}"

for idx, page in enumerate(docs):
    ë¡œì§ ì§„í–‰...
```



#### 2. PDFì—ì„œ ë©”íƒ€ ë°ì´í„° ì¶”ì¶œ

##### ì²« í˜ì´ì§€

í•œ í¬ìŠ¤íŠ¸ëŠ” ì—¬ëŸ¬ í˜ì´ì§€ë¡œ êµ¬ì„±ë¼ìˆê³  ê° í˜ì´ì§€ë¥¼ ëŒë©° í˜„ì¬ í˜ì´ì§€ê°€ ì–´ë–¤ í•œ í¬ìŠ¤íŠ¸ì˜ ì²« í˜ì´ì§€ë€ê±¸ ì•Œì•„ì•¼í•œë‹¤. í¬ìŠ¤íŠ¸ì˜ ì²« í˜ì´ì§€ëŠ” ì•„ë˜ì™€ ê°™ì´ êµ¬ì„±ëœë‹¤.

<img src="./../../images/2024-07-06-blog_gen_1/image-20240706111002541.png" alt="image-20240706111002541" style="zoom:66%;" />

ì´ë¯¸ì§€ë¥¼ ë³´ë©´ ë°œê²¬ ê°€ëŠ¥í•œ ê²ƒì´ ì²« í˜ì´ì§€ì—” ê°€ì¥ ë¨¼ì € ë©”íƒ€ ë°ì´í„°ê°€ ë‚˜ì˜¨ë‹¤ëŠ” ê²ƒì´ë‹¤. ë¨¼ì € ì´ ì •ë³´ë¥¼ ì¶”ì¶œí•  ê²ƒì´ë‹¤.

- `page.get_text_blocks()`ë¥¼ í•˜ë©´ íŠœí”Œì˜ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ë°ì´í„°ê°€ ë‚˜ì˜¨ë‹¤. ìœ„ í˜ì´ì§€ì˜ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

  ```python
  [
    (31.74799919128418,
    147.01950073242188,
    563.5275268554688,
    157.3695068359375,
    '2024/06/04 14:00\nhttp://blog.naver.com/{ë¸”ë¡œê·¸ ì£¼ì†Œ}\n',
    0,
    0),
   (31.74799919128418,
    43.086669921875,
    551.9480590820312,
    86.211669921875,
    'ë§›ì§‘ã…£[ì„œìš¸_ ... ì›¨ì´íŒ…, ë©”\në‰´ ì¶”ì²œ\në‰´ ì¶”ì²œ\n',
    1,
    0),
  
    ...
  
    (31.74799919128418,
    488.4794616699219,
    141.5570068359375,
    500.5544738769531,
    'ì„œìš¸ ì¤‘êµ¬ ...\n',
    8,
    0)
  ]
  ```

  ìœ„ ì˜ˆì‹œë¥¼ ë³´ë©´ í˜ì´ì§€ ë‚´ì—ì„œì˜ (x, y ë‘ ì ì˜ ì¢Œí‘œ ê°’ 4ê°œ, í…ìŠ¤íŠ¸, ì¸ë±ìŠ¤, _ ) ì´ëŸ° í˜•ì‹ì˜ íŠœí”Œì¸ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

- ì—¬ê¸°ì„œ í¬ìŠ¤íŠ¸ì˜ ì²« í˜ì´ì§€ì™€ ë‹¬ë¦¬ ì¼ë°˜ í˜ì´ì§€ë¼ë©´ ì²«ë²ˆì§¸ íŠœí”Œì— ë¸”ë¡œê·¸ URLì´ ìˆì§€ ì•Šì„ ê²ƒì´ë‹¤. ë”°ë¼ì„œ `if base_url in page.get_text_blocks()[0][4]`, ì¦‰ ë¸”ë¡œê·¸ urlì˜ ì¼ë¶€ê°€ ì²« ë¸”ë¡ í…ìŠ¤íŠ¸ ë¶€ë¶„ì— ì†í•œë‹¤ë©´ ì´ í˜ì´ì§€ëŠ” ì²« í˜ì´ì§€ë¼ëŠ” ì˜ë¯¸ì´ë‹¤.  

  - ë”°ë¼ì„œ ì € ì¡°ê±´ì´ Trueë¼ë©´ ì—¬ëŸ¬ ë©”íƒ€ ë°ì´í„°ë¥¼ ë½‘ì•„ë‚¼ ìˆ˜ ìˆë‹¤. ì•„ë˜ì™€ ê°™ì´ ì¶”ì¶œí•œë‹¤.
    ```python
    if base_url in page.get_text_blocks()[0][4]:
        post_meta_dict = dict() # ë©”íƒ€ ë°ì´í„° ë”•ì…”ë„ˆë¦¬ ìƒì„±
        ## Get Post metadata
        post_meta = page.get_text_blocks()[0][4].split("\n")
        post_meta_dict["post_datetime"] = post_meta[0].replace("/", "-")
        post_meta_dict["post_date"] = post_meta_dict["post_datetime"].split()[0]
        post_meta_dict["post_time"] = post_meta_dict["post_datetime"].split()[1]
        post_meta_dict["post_id"] = post_meta[1].split("/")[-1]
        post_meta_dict["post_url"] = post_meta[1]
        post_meta_dict["post_category"] = ''.join(list(dict.fromkeys(page.get_text_blocks()[2][4].split("\n"))))
        post_meta_dict["post_title"] = ''.join(list(dict.fromkeys(page.get_text_blocks()[1][4].split("\n"))))
    ```

  - ê·¸ë¦¬ê³  ë§Œë“¤ì–´ì¤€ ë©”íƒ€ ë°ì´í„°ë¥¼ ë¡œì»¬ì— ì €ì¥í•œë‹¤. ì´ ë•Œ í¬ìŠ¤íŠ¸ëª…ìœ¼ë¡œ í´ë”ë¥¼ í•˜ë‚˜ ë§Œë“ ë’¤ `metadata.txt`, `metadata.json`ìœ¼ë¡œ ë©”íƒ€ ë°ì´í„°ë“¤ì„ í•´ë‹¹ ê²½ë¡œì— ì €ì¥í•œë‹¤.
    ```python
    file_name = post_meta_dict["post_date"] + "_" + post_meta_dict["post_id"]  + "_" + post_meta_dict["post_title"]
    cur_path = os.path.join(post_dir, file_name).replace("/", "_").replace("?", "").strip() #  í˜„ì¬ í¬ìŠ¤íŠ¸ ì œëª©ìœ¼ë¡œ ìƒˆ ê²½ë¡œ ì§€ì •
    if idx == 0:
        prv_path = cur_path
    
    if os.path.exists(cur_path) == False: # ìœ„ ê²½ë¡œë¡œ í´ë” ìƒì„±
        os.mkdir(cur_path)
    with open(os.path.join(cur_path, "metadata.txt"), "wb") as meta_txt: # í…ìŠ¤íŠ¸ë¡œ ì¶”ì¶œ, ì €ì¥
        for k, v in post_meta_dict.items():
            meta_txt.write(f"{k}: {v}".encode("utf8"))
            meta_txt.write(bytes((12,)))
        meta_txt.close()
    
    with open(os.path.join(cur_path, "metadata.json"), "w") as meta_json: # JSONë„ ì €ì¥
        json.dump(post_meta_dict, meta_json)
        meta_json.close()
    ```

  - ë§ˆì§€ë§‰ìœ¼ë¡œ í˜„ì¬ í˜ì´ì§€ê°€ ì–´ë–¤ í˜„ì¬ í¬ìŠ¤íŠ¸ì˜ ì²« í˜ì´ì§€ë¼ëŠ” ê²ƒì„ ë§ˆí‚¹í•˜ê¸° ìœ„í•´ í˜„ì¬ post_idë¥¼ cur_post_idë¡œ ì €ì¥í•œë‹¤. ì°¸ê³ ë¡œ post_idëŠ” ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ URLì— ìˆëŠ” ìˆ«ì ê°’ì´ë‹¤.

    - ë§Œì•½ í¬ìŠ¤íŠ¸ë“¤ì˜ ì²«í˜ì´ì§€ë¼ë©´ prv_post_idë„ ê°™ì´ ì´ˆê¸°í™” í•´ì¤€ë‹¤. 
      ```python
      if idx == 0: # ì „ì²´ PDF  ì²« í˜ì´ì§€ë¼ë©´ cur_post_id, prv_post_id ë‘˜ë‹¤ í˜„ì¬ì˜ post_idë¡œ
          cur_post_id = prv_post_id = post_meta_dict['post_id']
      else: #í˜„ì¬ í¬ìŠ¤íŠ¸ì˜ idë¥¼ ìœ„ì—ì„œ ì¶”ì¶œí•œ ë©”íƒ€ ë°ì´í„°ì—ì„œ ê°€ì ¸ì˜¤ê¸°
          cur_post_id = post_meta_dict['post_id']
      first_page = True # ì²« í˜ì´ì§€ ë§ˆí‚¹
      print(idx, post_meta_dict["post_title"])
      print(cur_path, prv_path, '\n')
      ```

    

##### í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸(í…ìŠ¤íŠ¸) ì¶”ì¶œ

ì²« í˜ì´ì§€ì´ë“  ì•„ë‹ˆë“  ìŠ¤í¬ë¦½íŠ¸ëŠ” ì¡´ì¬í•  ê²ƒì´ë©° ì´ ì •ë³´ë„ ë”°ë¡œ ì €ì¥, exportë¥¼ ì§„í–‰í•œë‹¤. í…ìŠ¤íŠ¸ë“¤ì„ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™” í•œ ë’¤ì— ì•„ë˜ for ë¬¸ìœ¼ë¡œ í…ìŠ¤íŠ¸ ë¸”ë¡ë“¤ì„ ë„£ì–´ì¤€ë‹¤.

```python
for k, b in enumerate(page.get_text_blocks()):
    if k == len(page.get_text_blocks()) - 1: # ë§ˆì§€ë§‰ ë¸”ë¡ì€ ìŠ¤í‚µ
        continue
    elif first_page == True and k < 3: # ë³¸ í˜ì´ì§€ê°€ ì²« í˜ì´ì§€ì¼ ê²½ìš° 3ë²ˆì§¸ ë¸”ë¡ê¹Œì§€ëŠ” ìŠ¤í‚µ(ì œëª© ë“± ë³¸ë¬¸ì€ ì•„ë‹˜)
        continue
    else:
        cur_text = list(dict.fromkeys(b[4].split("\n")[:-1])) # ì¤‘ë³µëœ ë¬¸ì¥ ì œê±°, ë§ˆì§€ë§‰ ë¹ˆì¹¸ ì œê±°
        if len(cur_text) > 1: # ë¬¸ì¥ë“¤ ì‚¬ì´ì— ê²¹ì¹¨ì´ ìƒê¸°ë©´ ë¬¸ì¥ì´ 1ê°œ ì´ìƒì´ ë¨, ê²¹ì¹œê²ƒ ì œê±° í›„ í•œë¬¸ì¥ìœ¼ë¡œ
            cur_text = merge_strings(cur_text) 
        cur_text_blocks.append(cur_text)
    prv_path = cur_path
```

ì´ìœ ëŠ” ëª¨ë¥´ê² ìœ¼ë‚˜ get_text_blocks()ìœ¼ë¡œ ê°€ì ¸ì˜¨ í…ìŠ¤íŠ¸ë“¤ì´ ê°€ë” ì„œë¡œ ê²¹ì³ì ¸ ìˆëŠ” ê²½ìš°ê°€ ìˆëŠ”ë° ê·¸ ê²½ìš° merge_stringsì´ë€ í•¨ìˆ˜ë¥¼ ì •ì˜í•´ ê²¹ì¹œ ê²ƒì„ ì œê±°í•´ì¤¬ë‹¤.



##### ì‚¬ì§„ ì €ì¥

í•œ í˜ì´ì§€ ë‚´ì—ë„ ì—¬ëŸ¬ ì‚¬ì§„ë“¤ì´ ìˆëŠ” ë° `page.get_images()` í•¨ìˆ˜ë¡œ ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸ë“¤ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. ì´í›„ ì´ë¯¸ì§€ ê°ì²´ë¥¼ pymupdf.Pixmap ë¼ëŠ” ë‚´ì¥ëœ í•¨ìˆ˜ë“¤ë¡œ í”„ë¡œì„¸ì‹±í•œ ë’¤ í˜„ì¬ ê²½ë¡œì— ì €ì¥í•œë‹¤.
```python 
for image_index, img in enumerate(page.get_images(), start=1): # enumerate the image list
    xref = img[0] # get the XREF of the image
    pix = pymupdf.Pixmap(docs, xref) # create a Pixmap

    if pix.n - pix.alpha > 3: # CMYK: convert to RGB first
        pix = pymupdf.Pixmap(pymupdf.csRGB, pix)

    if os.path.exists(os.path.join(cur_path, 'images')) == False:
        os.mkdir(os.path.join(cur_path, 'images'))
    pix.save(os.path.join(cur_path, f'images/img_{str(idx).rjust(2, "0")}_{image_index}.png')) # save the image as png
    pix = None
```



##### ìŠ¤í¬ë¦½íŠ¸ ì €ì¥

ìœ„ì™€ ê°™ì´ ì§„í–‰í•˜ë‹¤ê°€ ë§ˆì§€ë§‰ í˜ì´ì§€ë¥¼ ë„˜ì–´ê°€ì„œ ê·¸ ë‹¤ìŒ í¬ìŠ¤íŠ¸ì˜ ì²« í˜ì´ì§€ë¡œ ì§„ì…í–ˆë‹¤ë©´ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ë„ ê²½ë¡œì— ì €ì¥í•œë‹¤.
```python
if prv_post_id != cur_post_id and len(os.listdir(prv_path)) < 6:
    with open(os.path.join(prv_path, "scripts.txt"), "wb") as scripts_txt:
        for j, block in enumerate(cur_text_blocks):
            if block[0][-1] == "?":
                cur_txt = block[0][:-1]
            else:
                cur_txt = block[0]
            cur_txt = cur_txt + "\n"
            scripts_txt.write(cur_txt.encode("utf8"))
        scripts_txt.close()

    ## ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì €ì¥í•  ë•Œ ìŠ¤í¬ë¦° ìº¡ì²˜ë„ ê°™ì´ ì§„í–‰
    screen_capture_loop(post_dir, prv_post_id)
    reindex_images(post_dir, prv_post_id)
    cur_text_blocks = []
```

ì´ë ‡ê²Œ ë˜ë©´ í¬ìŠ¤íŠ¸ ë³„ë¡œ ë‹¤ìŒê³¼ ê°™ì´ 4ê°œì˜ ë°ì´í„°ê°€ exportëœë‹¤.

![image-20240706115649066](./../../images/2024-07-06-blog_gen_1/image-20240706115649066.png)

ê·¸ë¦¬ê³  ì´ ë•Œ ë§ˆì§€ë§‰ìœ¼ë¡œ ì•„ë˜ì—ì„œ ì´ì–´ ì„¤ëª…í•  í¬ìŠ¤íŠ¸ ìë™ ìŠ¤í¬ë¦° ìº¡ì²˜(`screen_capture_loop(post_dir, prv_post_id))`ë„ ê°™ì´ ì§„í–‰í•œë‹¤. 



---





# Step2.  ë„¤ì´ë²„ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ìë™ ìº¡ì³

ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ê¸€ì€ íŠ¹ì •í•œ í¬ë§·ìœ¼ë¡œ(HTML, markdown) ì—¬ëŸ¬ ìŠ¤íƒ€ì¼ì´ ì§€ì •ë¼ìˆê¸°ì–´ plain textë§Œ ê°€ì§€ê³  ì›ë˜ ê¸€ê³¼ ë¹„ìŠ·í•˜ê²Œ ë§Œë“¤ê¸° í˜ë“¤ë‹¤. ê·¸ë¦¬ê³  ì¶”ì¶œí•œ PDF ì—­ì‹œ í¬ë§·ì´ ê±°ì˜ ì—†ëŠ” ìƒíƒœì˜€ë‹¤. 

ë”°ë¼ì„œ ìƒê°í•œ ê²ƒì´ ë¸”ë¡œê·¸ ìŠ¤í¬ë¦°ìƒ·ì„ ì°ì€ í›„ ì´ë¯¸ì§€ ë¶„ì„ì´ ê°€ëŠ¥í•œ LLM ëª¨ë¸ì„ ì‚¬ìš©í•´ HTML í¬ë§·ìœ¼ë¡œ ìµœëŒ€í•œ ì›ë˜ í¬ìŠ¤íŠ¸ì™€ ìœ ì‚¬í•˜ê²Œ ì‘ì„±í•˜ê²Œ í•˜ëŠ” ê²ƒì´ë‹¤.ì´ë¥¼ ìœ„í•´ ë¸”ë¡œê·¸ ì „ì²´ë¥¼ ìŠ¤í¬ë¦°ìƒ·ìœ¼ë¡œ ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í–ˆê³ , ìë™ìœ¼ë¡œ ì›¹í˜ì´ì§€ ì „ì²´ë¥¼ ìŠ¤í¬ë¦°ìƒ·í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ ì„œì¹˜í–ˆì§€ë§Œ **ê²°êµ­ì—” ìŠ¤ìŠ¤ë¡œ ê¸°ëŠ¥ê°œë°œì„ ì§„í–‰í–ˆë‹¤..ã…œã…œ**

ë¸”ë¡œê·¸ ì „ì²´ë¥¼ ìŠ¤í¬ë¦°ìƒ·ìœ¼ë¡œ ì €ì¥í•˜ê¸° ìœ„í•´ êµ¬í˜„í•œ ê¸°ëŠ¥ì„ ì„¤ëª…í•˜ê¸° ì•ì„œ ì—¬ëŸ¬ê°€ì§€ ìŠ¤í¬ë¦°ìƒ· ê¸°ëŠ¥ì´ ìˆëŠ” íŒ¨í‚¤ë¥¼ ì‹œë„í–ˆì§€ë§Œ ì˜ ë˜ì§€ ì•Šì•˜ë‹¤.

- selenium: ê°€ì¥ ìœ ëª…í•˜ê³  ë§ì´ ì“°ì´ëŠ” ì›¹í˜ì´ì§€ í…ŒìŠ¤íŒ…ì„ ìœ„í•œ ìë™í™” íŒ¨í‚¤ì§€ì´ë‹¤. ì›¹í˜ì´ì§€ ì—°ê²°, ìŠ¤í¬ë¦° ìº¡ì²˜ëŠ” ì˜ ë˜ì§€ë§Œ ìŠ¤í¬ë¡¤ì„ ë‚´ë¦¬ëŠ” ê¸°ëŠ¥ì´ ì•ˆëœë‹¤. 
- playwright, pypeteer, screenshotone ë“± ê¸°íƒ€ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë„ ì•„ì˜ˆ ê¸°ëŠ¥í•˜ì§€ ì•Šê±°ë‚˜ ìŠ¤í¬ë¡¤ ì´ë™ ë“± ê¸°íƒ€ ê¸°ëŠ¥ì´ ë§ˆë•…íˆ ì˜ë˜ì§€ ì•Šì•˜ë‹¤.

**ê²°êµ­ ì°¾ì•„ë‚¸ ë°©ë²•ì€ seleniumì„ í†µí•´ urlì„ ìƒˆì°½ìœ¼ë¡œ ì—´ê³  pyautoguië¥¼ ì´ìš©í•´ ë§ˆìš°ìŠ¤ë¥¼ ì§ì ‘ ì»¨íŠ¸ë¡¤í•˜ë©° ì—¬ëŸ¬ í™”ë©´ìœ¼ë¡œ ì˜ë¼ ìº¡ì²˜í•˜ëŠ” ê²ƒì´ë‹¤.**



##### selenium

ìš°ì„  ì…€ë ˆëŠ„ìœ¼ë¡œ chrome ë“œë¼ì´ë²„ë¥¼ ì„¤ì¹˜í•œë’¤ í˜ì´ì§€ë¥¼ ì—´ì–´ ìµœëŒ€ ì°½í¬ê¸°ë¥¼ í•´ì¤€ë‹¤.

```python
from selenium import webdriver
from selenium.webdriver.chrome.options import Options

options = Options()
driver = webdriver.Chrome()
driver.get(f"https://blog.naver.com/{blog_id}/{post_id}")
driver.maximize_window()
```



##### pyautogui

ë‹¤ìŒìœ¼ë¡œ pyautoguië¥¼ ì‚¬ìš©í•´ ì§ì ‘ ë§ˆìš°ìŠ¤ë¥¼ ì œì–´í•˜ë©° ìº¡ì²˜ - ìŠ¤í¬ë¡¤ì„ ë°˜ë³µí•œë‹¤. 2ê°œì˜ í•¨ìˆ˜ë¥¼ ì„ ì–¸í•´ loopë¡œ í•œ í˜ì´ì§€ì˜ ì²˜ìŒë¶€í„° ëê¹Œì§€ ì§„í–‰í–ˆë‹¤.

```python
def screen_area_capture(base_win, start_point, end_point, data_dir, file_name):
    if base_win.isActive == False:
        try:
            base_win.activate()
        except:
            pass
    img = ImageGrab.grab(bbox = (start_point[0], start_point[1], end_point[0], end_point[1]))
    img.save(os.path.join(data_dir, file_name))
    # img = Image.open(os.path.join(data_dir, 'test_pil.png'))

def capture_and_compare(base_win, idx, data_dir):
    if idx == 1:
        time.sleep(2)
        if os.path.exists(os.path.join(data_dir, "screen_captures")) == False:
            os.mkdir(os.path.join(data_dir, "screen_captures"))

    before = pg.screenshot().crop((0, 100, 2400, 800))
    screen_area_capture(
        base_win, 
        (460 , 1025 if idx == 1 else 377), 
        (1600, 1605),
        data_dir = os.path.join(data_dir, "screen_captures"),
        file_name = f"{idx}.png"
    )
    pg.moveTo(400, 1000)
    time.sleep(.04)
    pg.click()
    time.sleep(.04)

    pg.scroll(-737)
    time.sleep(.04) 
    after = pg.screenshot().crop((0, 100, 2400, 800))
    return before == after  # ë‘ ìŠ¤í¬ë¦°ìƒ· ë¹„êµ
```

ì½”ë“œê°€ ê¸¸ì§€ë§Œ ì°¨ë¡€ëŒ€ë¡œ ì„¤ëª…í•˜ìë©´...

1. ì¸ë±ìŠ¤ë¥¼ 1ë¶€í„° ì™¸ë¶€ë¡œ ë°›ì•„ í•œë²ˆì˜ ìº¡ì²˜ë¥¼ ì§„í–‰í•œë‹¤. 
2. ìŠ¤í¬ë¦° ìº¡ì²˜í•œ ì´ë¯¸ì§€ë“¤ì„ ì €ì¥í•˜ê¸° ìœ„í•´ screen_capturesë¼ëŠ” ê²½ë¡œë¥¼ ë§Œë“¤ì–´ ì¤€ë‹¤.
   - ì›¹í˜ì´ì§€ ë¡œë”©ì„ ìœ„í•´ ìš°ì„  idx==1 ì´ë¼ë©´ 2ì´ˆ ì‰¬ì–´ì¤€ë‹¤.
3. ì´í›„ íŠ¹ì • ì˜ì—­ì„ ìº¡ì²˜í•´ì¤€ë’¤ beforeì— ë„£ëŠ”ë‹¤.
4. screen_area_capture í•¨ìˆ˜ë¡œ íŠ¹ì • ì¢Œí‘œì˜ì—­ì„ ìº¡ì²˜ í›„ screen_captures ë¡œì»¬ í´ë”ì— ì €ì¥í•œë‹¤.
   - PILì˜ ImageGrabì´ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ íŠ¹ì • í”½ì…€ ì¢Œí‘œ ë°”ìš´ë”ë¦¬ ì•ˆìª½ë§Œ ìº¡ì²˜í•œë‹¤.
5. pyautoguië¥¼ ì´ìš©í•´ íŠ¹ì • ì¢Œí‘œë§Œí¼ ìŠ¤í¬ë¡¤ì„ ë‚´ë¦°ë‹¤.
   - ì´ í”½ì…€ ì¢Œí‘œëŠ” ì‚¬ìš©ì í™”ë©´ì— ë”°ë¼ ë‹¤ë¥¼ ê²ƒì´ë‹¤. ì¡°ì ˆì´ í•„ìš”í•˜ë‹¤.
6. beforeì™€ ê°™ì€ ìº¡ì²˜í•´ì¤€ ë’¤ after ë³€ìˆ˜ì— ë„£ëŠ”ë‹¤.
7. beforeì™€ afterê°€ ê°™ì€ì§€ ë‹¤ë¥¸ì§€ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤.

ì´í›„ í•¨ìˆ˜ë¥¼ ë‚˜ì™€ì„œ beforeì™€ afterê°€ ê°™ë‹¤ë©´, ì¦‰ ì›¹í˜ì´ì§€ì˜ ìŠ¤í¬ë¡¤ì„ ë‚´ë ¤ë„ ìŠ¤í¬ë¦° ë³€í™”ê°€ ì—†ì–´ì¡Œë‹¤ë©´ loopë¥¼ ë©ˆì¶˜ë‹¤.



##### ìº¡ì²˜ ì¡°ê° ì €ì¥ ë° ìŠ¤í¬ë¦° ìº¡ì²˜ ì´ì–´ ë¶™ì´ê¸°

ë£¨í”„ë¥¼ ëŒë©´ì„œ ìº¡ì²˜í•  ë•Œ ë§ˆë‹¤ postì˜ ê²½ë¡œì— ë“¤ì–´ê°€ ìº¡ì²˜í•œ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•´ì¤€ë‹¤. ë°”ìš´ë”© ë°•ìŠ¤ ì¢Œí‘œì™€ ImageGrabì„ ì‚¬ìš©í•´ ì–»ì€ img ê°ì²´ì˜ save ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ê°„ë‹¨í•˜ê²Œ ì €ì¥ëœë‹¤.

```python
img = ImageGrab.grab(bbox = (start_point[0], start_point[1], end_point[0], end_point[1]))
img.save(os.path.join(data_dir, file_name))
```

ë§ˆì§€ë§‰ìœ¼ë¡œ ì¡°ê°ì¡°ê° ìº¡ì²˜í•œ ì´ë¯¸ì§€ë“¤ì„ ìœ„ì•„ë˜ë¡œ ì´ì–´ ë¶™ì—¬ì¤€ë‹¤. ë‘ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì™€ ìœ„ì•„ë˜ë¡œ ë¶™ì—¬ì£¼ëŠ” concat_img_vertical ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ê°„ë‹¨íˆ ì •ì˜í•´ ì‚¬ìš©í–ˆë‹¤. ê·¸ëŸ¬ë©´ ì „ì²´ ìŠ¤í¬ë¦° ìº¡ì²˜ê°€ ì™„ì„±ëœë‹¤.

```python
def concat_img_vertical(image1, image2):
    # ì´ë¯¸ì§€ ì‚¬ì´ì¦ˆ ì°¸ì¡°
    width1, height1 = image1.size
    width2, height2 = image2.size

    # ë‘ ì´ë¯¸ì§€ì˜ ìµœëŒ€ ë†’ì´, ë„ˆë¹„ë¥¼ ê³„ì‚°
    result_width = max(width1, width2)
    result_height = height1 + height2

    # ìƒˆ ì´ë¯¸ì§€ ê°ì²´ ìƒì„± í›„ ë‘ ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸°
    result_image = Image.new('RGB', (result_width, result_height))
    result_image.paste(image1, (0, 0))
    result_image.paste(image2, (0, height1))

    # ê²°ê³¼ ì´ë¯¸ì§€ ë°˜í™˜
    return result_image

num_imgs = len(os.listdir(os.path.join(post_dir, cur_post_dir, "screen_captures")))
for i in range(0, num_imgs - 3, 3):
    if i + 2  > num_imgs:
        break
    image1 = Image.open(os.path.join(post_dir, cur_post_dir, f"screen_captures/{str(i + 1)}.png"))
    image2 = Image.open(os.path.join(post_dir, cur_post_dir, f"screen_captures/{str(i + 2)}.png"))
    image3 = Image.open(os.path.join(post_dir, cur_post_dir, f"screen_captures/{str(i + 3)}.png"))
    if i == 0:
        concat_img = concat_img_vertical(image1=image1, image2=image2)
        concat_img = concat_img_vertical(image1=concat_img, image2=image3)
    else:
        concat_img = concat_img_vertical(image1=concat_img, image2=image1)
        concat_img = concat_img_vertical(image1=concat_img, image2=image2)
        concat_img = concat_img_vertical(image1=concat_img, image2=image3)
concat_img.save(os.path.join(post_dir, cur_post_dir, 'concat_screen_capture.png'))
```





<hr>

ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„  ë§Œë“  í¬ìŠ¤íŠ¸ ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•´ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ë¯¸ì§€ ë‚´ì˜ ì–‘ì‹ê³¼ ë¹„ìŠ·í•˜ê²Œ ë§Œë“œëŠ” ëª¨ë¸ì„ ì†Œê°œí•  ì˜ˆì •ì´ë‹¤.

<br>

<br>



<hr data-ke-style="style4"/>

> ë¬¸ì„œ ë° ë§í¬

- ë³¸ í”„ë¡œì íŠ¸ Github Repo [[ğŸ”—](https://github.com/lymanstudio/proj_blog_post_gen)]
